function RebootDataModel(){this.state="unknown";this.changedState=new Event(this);this.stateMachine(this,"init")}RebootDataModel.prototype={stateMachine:function(b,a){console.log("In Reboot state Machine "+b.state+" "+a);switch(b.state){case"unknown":if(a==="init"){b.state="reboot";b.changedState.notify({state:b.state})}break;case"reboot":if(a==="rebootError"){b.state=a;b.changedState.notify({state:b.state})}else{if(a==="rebootDone"){b.state=a;b.changedState.notify({state:b.state})}else{if(a==="rebootFail"){b.state=a;b.changedState.notify({state:b.state})}}}break;case"finish":b.state="unknown";b.changedState.notify({state:b.state});break}},reinit:function(){this.state="unknown";this.stateMachine(this,"init")},destroy:function(){},finish:function(){this.stateMachine(this,"finish")},rebootDone:function(){var c=new Object();var d=this;$.mobile.loading("show",{text:"Please wait...",textVisible:true,textonly:true,html:""});c.command="reboot";var a=function(e){if(e.success===0){d.stateMachine(d,"rebootDone")}else{d.stateMachine(d,"rebootFail")}};var b=function(){d.stateMachine(d,"rebootError")};this.stateMachine(this,"reboot");$.ajax({type:"POST",url:"/sys/command",data:JSON.stringify(c),async:"false",dataType:"json",contentType:"application/json",timeout:5000,success:a,error:b}).done()}};function RebootDataView(c,d,e,a,b){this._model=c;this.pageContent=d;this.pageHeaderTitle=e;this.pageHeaderHomeBtn=a;this.pageHeaderBackBtn=b;var f=this;this.pageHeaderHomeBtn.hide();this.pageHeaderBackBtn.hide();this.pageHeaderTitle.text("Please wait...");this.rebootIntended=function(){f.renderReboot()};this.rebootDone=function(){f._model.rebootDone()};this.backFromReboot=function(){f.render({state:"rebootCancel"})};this.show=function(g){this._model.changedState.attach(function(i,h){f.render(h)});if(g==="reboot"){this.rebootIntended(g);return this}return null}}RebootDataView.prototype={render:function(a){console.log("Render: Reboot : "+a.state+" Er:"+a.err+" Ev:"+a.event);$.mobile.loading("hide");switch(a.state){case"rebootCancel":$("#home").click();break;case"rebootError":this.renderConnError();break;case"rebootDone":this.renderRebootSuccess();break;case"rebootFail":this.renderRebootFailed();break;case"unknown":if(a.err==="conn_err"){this.renderConnError()}break}return},hide:function(){this._model.finish();this._this=null;$.mobile.loading("hide");this.pageHeaderBackBtn.hide();this.pageHeaderHomeBtn.hide();this.pageContent.html("");this.pageHeaderTitle.text("")},renderRebootFailed:function(){this.pageHeaderBackBtn.hide();this.pageHeaderHomeBtn.hide();this.pageContent.html("");this.pageHeaderTitle.text("Error");this.pageHeaderHomeBtn.show();this.pageContent.append($("<h3/>").append("Error in rebooting device. Please refresh and retry."))},renderConnError:function(){this.pageHeaderBackBtn.hide();this.pageHeaderHomeBtn.hide();this.pageContent.html("");this.pageHeaderTitle.text("Error");this.pageHeaderHomeBtn.show();this.pageContent.append($("<h3/>").append("The connection to the device has been lost. Please re-connect to the device network and retry"))},doReinit:function(a){a._model.reinit()},renderRebootSuccess:function(){this.pageHeaderBackBtn.hide();this.pageHeaderHomeBtn.hide();this.pageContent.html("");this.pageHeaderTitle.text("Success");this.pageContent.append($("<h3/>").append("The device rebooted successfully. Please re-launch the application or re-load browser page after the device boots up."))},renderReboot:function(a){this.pageHeaderTitle.text("Reboot");$.mobile.loading("hide");this.pageHeaderHomeBtn.show();this.pageHeaderBackBtn.hide();this.pageContent.html("");this.pageContent.append($("<h3> Reboot Device </h3>")).append($("<div/>",{"class":"ui-grid-a"}).append($("<div/>",{"class":"ui-block-a"}).append($("<a/>",{href:"#","data-role":"button",id:"reboot-cancel-btn","data-theme":"c"}).append("Cancel"))).append($("<div/>",{"class":"ui-block-b"}).append($("<a/>",{href:"#","data-role":"button",id:"reboot-btn"}).append("Reboot"))));this.pageContent.trigger("create");$("#reboot-cancel-btn").bind("click",this.backFromReboot);$("#reboot-btn").bind("click",this.rebootDone)}};var reboot_init=function(){return new RebootDataModel()};var reboot_show=function(a,b){return new RebootDataView(a,$("#page_content"),$("#header #title"),$("#header #home"),$("#header #back")).show(b)};